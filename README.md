## 🐥 유아 용품 교환 나눔 플랫폼 (도담덕)


#### Project nickname : 도담덕
#### Project execution period : 2023.09.03 ~ Current

- 어린아이가 탈 없이 잘 놀며 자라는 마음의 뜻과 아이들이 좋아하는 귀여운 오리를 합쳐 지어진 '도담덕'
- 일회성으로 사용되고 버려지는 장난감들.
- 전세계 플라스틱 폐기물의 30%가 장난감인 실태.
- 해당 문제를 해결하고자 유아용품 교환&나눔 플랫폼인 도담덕을 생각하게 되었습니다.


## 🍪 주요 기능

- 1:1 채팅 기능
    
- 성동구 장난감 도서관 대여 리스트 화면
    
- 교환/나눔 게시글 기능
    
- 정보 공유 게시글 기능

- 게시글 카테고리 기능 

### 📱 화면

<table>
  <tr>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/fd0f4017-bfaa-4b4b-9d68-d3e26d0e80b2"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/1fa1ccdb-a2c8-430a-b03d-1760724e6926"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/25011e41-acf4-41f9-ba53-9d68b959294b"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/5ebc7566-7228-4da9-bc88-aba50c83f76c"></td>
  </tr>
    <td align="center"><b>토큰 인증 방식 로그인</b></td>
    <td align="center"><b>온보딩 화면</b></td>
    <td align="center"><b>회원가입 화면</b></td>
    <td align="center"><b>로그인 화면</b></td>
</table>
<br>

<table>
  <tr>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/624757c1-876f-4790-8bd7-51dda13c2570"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/210950e5-a45a-4fef-833e-bccdbd8c6a3c"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/e8454905-f20d-4a89-acbd-a074d1496039"></td>
      <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/a6788af0-aded-47c1-8735-11782c86e440"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/8efa9f7b-910b-44f5-a5d8-1d27367474bd"></td>
  </tr>
    <td align="center"><b>교환/나눔 화면</b></td>
    <td align="center"><b>교환/나눔 작성 화면</b></td>
    <td align="center"><b>교환/나눔 상세 화면</b></td>
    <td align="center"><b>교환/나눔 수정/삭제 화면</b></td>
    <td align="center"><b>검색 화면</b></b></td>
</table>
<br>

<table>
  <tr>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/ef6d3cf9-47a0-4b4f-b527-1ce0735b48a0"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/c063cb1f-392e-4e61-b61d-53428d0117d5"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/e2328d0c-ab06-4b3f-8ec0-9c56acf5554a"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/fd420c3e-e521-477b-ba52-65d50c599f58"></td>
  </tr>
    <td align="center"><b>장난감 도서관 대여 화면</b></td>
    <td align="center"><b>채팅 목록</b></td>
    <td align="center"><b>채팅 화면</b></td>
  <td align="center"><b>게시글 화면</b></td>
</table>
<br>

<table>
  <tr>
     <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/0b541307-6b1a-4c2a-a729-ec7fd8144ca5"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/72132e52-fa61-460d-a4d5-e5c56641124d"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/3df5d3db-9f1f-417e-9bc9-9f68c01dbf2f"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/1fa6bbe2-ca96-4f69-9d26-a08cc7c8ce9a"></td>
    <td><img width="200" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/67a52f38-edc1-4ffc-93a1-aa0dfa9ee743"></td>
  </tr>
    <td align="center"><b>게시글 작성 화면</b></td>
    <td align="center"><b>게시글 태그 선택</b></td>
    <td align="center"><b>게시글 상세</b></td>
    <td align="center"><b>게시글 상세 - 댓글</b></td>
  <td align="center"><b>사용자 화면</b></td>
</table>
<br>

---

### ⭐️ Architecture 

<img width="794" alt="Architecture" src="https://github.com/DodamDuck/DodamDuck/assets/54762273/cf6df375-499a-46c1-b507-b10b8e3ea969">

---

## 💫 기술 스택
 - Jetpack Compose
 - Room
 - Hilt
 - Coroutine
 - Jetpack Navigation
 - Git Actions
 - Flow
 - Coil
 - Okhttp3
 - Retrofit2

---
## ✨ 코드 리팩토링 

[PR](https://github.com/DodamDuck/DodamDuck/pull/230)

기존 ViewModel 코드에서 API 호출 결과를 처리하는 로직에서 중복되는 부분이 많아 리팩토링의 필요성을 느끼게 되었습니다. <br>
API 호출과 결과 처리를 더 안정적이고 유지보수가 용이하게 만들기 위해 리팩토링 작업을 진행하였습니다. <br> <br>
기존 코드의 복잡성을 줄이고 코드의 가독성을 향상시키기 위해 <br>
SafeApiResult 클래스를 추가해 기존 보일러 플레이트 코드들을 제거해 <br>
ViewModel 클래스들의 불필요한 코드 라인 수를 `27%` 개선했습니다.

### 기존 코드 
```kotlin
fun getTradeLists() {
    viewModelScope.launch {
        sendEvent(TradeEvent.OnLoading)
        getTradeListUseCase().collectLatest { apiResult ->
            when (apiResult) {
                is ApiResult.Success ->  sendEvent(TradeEvent.OnSuccessTradeList(apiResult.value))
                is ApiResult.Error -> sendEvent(TradeEvent.OnError)
                is ApiResult.Exception -> {}
            }
        }
    }
}

fun searchTrade(query: String) {
    viewModelScope.launch {
        sendEvent(TradeEvent.OnLoading)
        searchTradeUseCase(query)
            .collectLatest { apiResult ->
                when (apiResult) {
                    is ApiResult.Success ->  sendEvent(TradeEvent.OnSuccessTradeList(apiResult.value))
                    is ApiResult.Error -> sendEvent(TradeEvent.OnError)
                    is ApiResult.Exception -> {}
            }
        }
    }
}
```

### 개선 후 코드 
```kotlin
fun getTradeLists() {
    viewModelScope.processApiResult(getTradeListUseCase()) {
        onLoading { sendEvent(TradeEvent.OnLoading) }
        onSuccess { data -> sendEvent(TradeEvent.OnSuccessTradeList(data)) }
        onError { sendEvent(TradeEvent.OnError) }
    }
}

fun searchTrade(query: String) {
    viewModelScope.processApiResult(searchTradeUseCase(query)) {
        onLoading { sendEvent(TradeEvent.OnLoading) }
        onSuccess { data -> TradeEvent.OnSuccessTradeList(data) }
        onError { sendEvent(TradeEvent.OnError) }
    }
}
```

```kotlin
class SafeApiResult<T> {
    private var onSuccess: (suspend (T) -> Unit)? = null
    private var onLoading: (suspend () -> Unit)? = null
    private var onError: (suspend (ApiResult.Error) -> Unit)? = null
    private var onException: (suspend (Throwable) -> Unit)? = null

    fun onSuccess(action: suspend (T) -> Unit) {
        onSuccess = action
    }

    fun onLoading(action: suspend () -> Unit) {
        onLoading = action
    }

    fun onError(action: suspend (ApiResult.Error) -> Unit) {
        onError = action
    }

    fun onException(action: suspend (Throwable) -> Unit) {
        onException = action
    }

    suspend fun process(flow: Flow<ApiResult<T>>, scope: CoroutineScope) {
        scope.launch {
            onLoading?.invoke()
            flow.collectLatest { result ->
                when (result) {
                    is ApiResult.Success -> onSuccess?.invoke(result.value)
                    is ApiResult.Error -> onError?.invoke(result)
                    is ApiResult.Exception -> onException?.invoke(result.exception)
                }
            }
        }
    }
}

inline fun <T> CoroutineScope.processApiResult(
    flow: Flow<ApiResult<T>>,
    init: SafeApiResult<T>.() -> Unit
): SafeApiResult<T> {
    val processor = SafeApiResult<T>().apply(init)
    launch {
        processor.process(flow, this)
    }
    return processor
}
```
